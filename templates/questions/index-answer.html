<!doctype html>
<html lang="en">
<head>
{% include 'questions/header.html' %}       
    <script>
        window.table;
        $(document).ready( function () {
            window.table = $('#marksheet').DataTable({
                order: [[ 1, "desc" ]],
                paging: false,
                autoWidth: true,
                columnDefs: [
                    { width: '50%', targets: 0 }
                ],
            });           
         
            
            // Function to get column visibility from cookies
            function getColumnVisibility(columnName) {
                const name = `col-${columnName}=`;
                const decodedCookie = decodeURIComponent(document.cookie);
                const ca = decodedCookie.split(';');
                for(let i = 0; i < ca.length; i++) {
                    let c = ca[i].trim();
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length) === 'true';
                    }
                }
                return null;
            }
            
            // Apply saved column visibility from cookies
            $('a.toggle-vis, button.toggle-vis').each(function() {
                let columnName = $(this).text().toLowerCase();
                let savedVisibility = getColumnVisibility(columnName);
                
                if (savedVisibility !== null) {
                    let colNum = $(this).attr('data-column');
                    let column = window.table.column(colNum);
                    column.visible(savedVisibility);
                    
                    // Update imageControls visibility for Image column
                    if (columnName === 'image') {
                        if (savedVisibility) {
                            $('#imageControls').css('display', 'contents');
                        } else {
                            $('#imageControls').css('display', 'none');
                        }
                    }
                }
            });
            
            // Initialize toggle button styles
            $('a.toggle-vis, button.toggle-vis').each(function() {
                let colNum = $(this).attr('data-column');
                let column = window.table.column(colNum);
                let isVisible = column.visible();
                if (isVisible) {
                    $(this).css({'background-color': '#4CAF50', 'color': 'white', 'border-color': '#45a049'});
                } else {
                    $(this).css({'background-color': '#f5f5f5', 'color': '#999', 'border-color': '#ccc'});
                }
            });        });            
    </script>
    <style>
        input.mark, .lock {
            width: 300px;
            font-size: xx-large;
        }
        .toggle-vis {
            padding: 5px 12px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        .toggle-vis:hover {
            border-color: #999;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
	<header>
        <div style="margin-bottom: 10px;">
            <a href="../../index.html">Back to the question list</a>
        </div>
        <h1>Validation forms for {{studentsScriptFileName}} - {{question}}</h1>
	</header>	
	<section> 
        <div id="dialog" title="Large Image">
            <img id="largeImage" src="" style="vertical-align: top; padding: 0px 10px 10px 2px; width: 100%; height: 100%" />
        </div>

        <div style="margin-bottom: 15px;">
            <!-- Control Form - First Row -->
            <form id="controlForm" action="" method="get" style="display: flex; gap: 8px 12px; font-size: 14px; align-items: center; flex-wrap: wrap; margin-bottom: 8px;">
                <div id="imageControls" style="display: contents;">
                    <div style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                        <label for="zoom" style="font-size: 14px;">Zoom:</label>
                        <input type="range" id="zoom" name="zoom" min="0.1" max="2" value="1" step="0.1" style="width: 80px;" />  
                        <span id="currentZoom" style="width: 25px; font-size: 13px;">1</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                        <label for="top" style="font-size: 14px;">Top:</label>
                        <input type="number" id="top" name="top" min="0" step="10" class="changeBoundBox" value="{{estimatedBoundingBox["top"]}}" style="width: 60px; font-size: 14px;" />
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                        <label for="left" style="font-size: 14px;">Left:</label>
                        <input type="number" id="left" name="left" min="0" step="10" class="changeBoundBox" value="{{estimatedBoundingBox["left"]}}" style="width: 60px; font-size: 14px;" />
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                        <label for="height" style="font-size: 14px;">Height:</label>
                        <input type="number" id="height" name="height" min="0" step="10" class="changeBoundBox" value="{{estimatedBoundingBox["height"]}}" style="width: 60px; font-size: 14px;" />
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                        <label for="width" style="font-size: 14px;">Width:</label>
                        <input type="number" id="width" name="width" min="0" step="10" class="changeBoundBox" value="{{estimatedBoundingBox["width"]}}" style="width: 60px; font-size: 14px;" />
                    </div>
                </div>
            </form>
            
            <!-- Toggle Buttons - Second Row -->
            <div style="display: flex; gap: 3px; align-items: center;">
                <span style="font-weight: bold; font-size: 11px; white-space: nowrap;">Show/Hide:</span>
                <button type="button" class="toggle-vis" data-column="0" style="padding: 2px 5px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap;">Image</button>
                <button type="button" class="toggle-vis" data-column="1" style="padding: 2px 5px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap;">Answer</button>
            </div>
        </div>
        <div>
            <p>If your type in the mark, it will be locked. To unlock, click on the mark below the mark input.</p>
        </div>
        <div style="margin: 20px 0; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
            {% if prev_question %}
                <a href="../{{prev_question}}/index.html">← Previous: {{prev_question}}</a>
            {% else %}
                <span style="color: #999;">← Previous</span>
            {% endif %}
            <span style="margin: 0 10px;">|</span>
            {% if next_question %}
                <a href="../{{next_question}}/index.html">Next: {{next_question}} →</a>
            {% else %}
                <span style="color: #999;">Next →</span>
            {% endif %}
        </div>
        <form id="markForm" action="" method="get" class="form">
            <table id="marksheet" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Answer</th>
                  </tr>
                </thead>
                <tbody>
{% for index, row in dataTable.iterrows() -%}
                  <tr>          
                    <td> 
                        <div id="crop-{{row["page"]}}-container" >
                            <img src="../../{{row["Image"]}}" 
                                 id="crop-{{row["page"]}}" 
                                 class="answerImage crop-{{row["page"]}}"
                                 alt="{{row["Answer"]}}" 
                                 data-left="{{row["left"]}}"
                                 data-top="{{row["top"]}}"
                                 data-width="{{row["width"]}}"
                                 data-height="{{row["height"]}}"
                            />
                        </div>   
                    </td>
                    <td>
                        <input type="text" id="mark-{{row["page"]}}"
                               class="mark" 
                               data-similarity="{{row["Similarity"]}}"
                               value="{{row["Answer"]}}"
                               required /> 
                        <span id="mark-{{row["page"]}}-locked" class="lock"></span>
                    </td>
                  </tr>      
{% endfor %} 
                </tbody>
            </table>
        </form>
        <div style="margin: 20px 0; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
            <a href="../../index.html">Back to the question list</a>
            <span style="margin: 0 20px;">|</span>
            {% if prev_question %}
                <a href="../{{prev_question}}/index.html">← Previous: {{prev_question}}</a>
            {% else %}
                <span style="color: #999;">← Previous</span>
            {% endif %}
            <span style="margin: 0 10px;">|</span>
            {% if next_question %}
                <a href="../{{next_question}}/index.html">Next: {{next_question}} →</a>
            {% else %}
                <span style="color: #999;">Next →</span>
            {% endif %}
        </div>
	</section>
	<footer>
		<p>Created by Higher Diploma in Cloud and Data Centre Administration Developement Team. </p>
	</footer>
</body>
</html>